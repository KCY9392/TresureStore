<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="sellMapper">


<!-- type은 mybatis-config에서 sell 라는 별칭을 정해두었음 -->
<resultMap type="sell" id="sellResultSet" >

<id column="SELL_NO" property="sellNo"></id>
	<result column="USER_NO" property="userNo"></result>
	<result column="CATEGORY_NO" property="categoryNo"></result>
	<result column="SELL_TITLE" property="sellTitle"></result>
	<result column="SELL_CONTENT" property="sellContent"></result>
	<result column="IMAGE_SRC" property="imgSrc"></result>
	<result column="COUNT" property="count"></result>
	<result column="PRICE" property="price"></result>
	<result column="SELL_STATUS" property="sellStatus"></result>
	<result column="CREATE_DATE" property="createDate"></result>
	<result column="UPDATE_DATE" property="updateDate"></result>
	<result column="STATUS" property="status"></result>

	<result column="HEART_NUM" property="heartNum"></result>


</resultMap>

	<select id="sellListselect" resultMap="sellResultSet">
		SELECT 
	    	SELL_NO, CATEGORY_NO, SELL_TITLE, IMAGE_SRC, PRICE, HEART_NUM
		FROM SELL 
		WHERE STATUS = 'Y' AND SELL_STATUS = 'I' AND ROWNUM <![CDATA[ <= ]]> 40
	</select>
	
	
	<select id="mypageSellList" resultMap="sellResultSet" parameterType="Integer">
	
	SELECT 
             SELL_NO, CATEGORY_NO, SELL_TITLE, IMAGE_SRC, PRICE, HEART_NUM
            FROM SELL 
            JOIN MEMBER USING(USER_NO)
            WHERE USER_NO=#{userNo}
		
	</select>
	
	<!-- 채팅방에 보이는 판매제품정보 --> 
	<select id="selectSellProduct" parameterType="int" resultMap="sellResultSet">
		SELECT CR.CHATROOM_NO,
		       S.SELL_NO AS "SELL_NO",
		       S.USER_NO AS "USER_NO",
		       CATEGORY_NAME,
		       SELL_TITLE,
		       SELL_CONTENT,
		       IMAGE_SRC,
		       S.COUNT,
		       PRICE,
		       S.CREATE_DATE AS "CREATE_DATE",
		       HEART_NUM,
		       AVG
		FROM CHAT_ROOM CR
		JOIN SELL S ON (S.SELL_NO = CR.SELL_NO)
        JOIN CATEGORY C ON (S.CATEGORY_NO = C.CATEGORY_NO)
		JOIN MEMBER M ON (S.USER_NO = M.USER_NO)
		JOIN (SELECT AVG(REV_SCORE) AS "AVG",
		       S.USER_NO
		FROM REVIEW R
		JOIN SELL S ON(R.SELL_NO = S.SELL_NO)
		GROUP BY S.USER_NO) PP ON (PP.USER_NO = S.USER_NO)
		WHERE CHATROOM_NO = ${chatRoomNo} AND S.STATUS = 'Y' AND M.STATUS = 'Y'
	</select>
	



</mapper>